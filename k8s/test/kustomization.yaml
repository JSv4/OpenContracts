apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Test environment - includes base but removes celerybeat
resources:
  - ../base

# Remove celerybeat deployment for test environment
patches:
  - patch: |
      $patch: delete
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: celerybeat
  - path: django-patch.yaml
    target:
      kind: Deployment
      name: django
  - path: celeryworker-patch.yaml
    target:
      kind: Deployment
      name: celeryworker
  - path: django-probes-patch.yaml
    target:
      kind: Deployment
      name: django
  - path: celeryworker-probes-patch.yaml
    target:
      kind: Deployment
      name: celeryworker
